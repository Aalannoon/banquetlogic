<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seniority Scheduler</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}

section {
  background: white;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 6px;
}

input, select, button {
  padding: 6px;
  margin: 4px 0;
}

button {
  cursor: pointer;
}

.list-item {
  display: flex;
  justify-content: space-between;
  margin: 4px 0;
}

table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: left;
}

th {
  background: #eee;
}

.employee-name {
  font-weight: bold;
}
</style>
</head>

<body>

<h1>Seniority Scheduler (Stable Base)</h1>

<section>
  <h2>Add Employee</h2>
  <input id="empName" placeholder="Name">
  <select id="empType">
    <option value="full">Full Time</option>
    <option value="part">Part Time</option>
  </select>
  <select id="empPref">
    <option value="morning">Morning</option>
    <option value="midday">Midday</option>
    <option value="night">Night</option>
  </select>
  <button onclick="addEmployee()">Add Employee</button>

  <h3>Employees</h3>
  <div id="employeeList"></div>
</section>

<section>
  <h2>Add Event</h2>
  <input type="date" id="eventDate">
  <input type="time" id="eventStart">
  <input type="time" id="eventEnd">
  <input type="number" id="eventGuests" placeholder="Guests">
  <button onclick="addEvent()">Add Event</button>

  <h3>Events</h3>
  <div id="eventList"></div>
</section>

<section>
  <button onclick="generateSchedule()">Generate Schedule</button>
</section>

<section>
  <h2>Schedule Output</h2>
  <div id="schedule"></div>
</section>

<script>
let employees = JSON.parse(localStorage.getItem("employees") || "[]");
let events = JSON.parse(localStorage.getItem("events") || "[]");
let schedule = {};

function save() {
  localStorage.setItem("employees", JSON.stringify(employees));
  localStorage.setItem("events", JSON.stringify(events));
}

/* ================= EMPLOYEES ================= */

function renderEmployees() {
  const list = document.getElementById("employeeList");
  list.innerHTML = "";
  employees.forEach((e, i) => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.innerHTML = `${e.name} (${e.type}, ${e.preference})
      <button onclick="removeEmployee(${i})">❌</button>`;
    list.appendChild(div);
  });
}

function addEmployee() {
  const name = empName.value.trim();
  if (!name) return;

  employees.push({
    name,
    type: empType.value,
    preference: empPref.value
  });

  save();
  renderEmployees();
  empName.value = "";
}

function removeEmployee(i) {
  employees.splice(i, 1);
  save();
  renderEmployees();
}

/* ================= EVENTS ================= */

function renderEvents() {
  const list = document.getElementById("eventList");
  list.innerHTML = "";
  events.forEach((e, i) => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.innerHTML = `${e.date} ${e.start}-${e.end} (${e.guests} guests)
      <button onclick="removeEvent(${i})">❌</button>`;
    list.appendChild(div);
  });
}

function addEvent() {
  events.push({
    date: eventDate.value,
    start: eventStart.value,
    end: eventEnd.value,
    guests: Number(eventGuests.value)
  });

  save();
  renderEvents();
}

function removeEvent(i) {
  events.splice(i, 1);
  save();
  renderEvents();
}

/* ================= SCHEDULING ================= */

function recommendServers(guests) {
  if (guests <= 50) return 2;
  if (guests <= 100) return 3;
  if (guests <= 200) return 5;
  if (guests <= 400) return 8;
  return 10;
}

function generateSchedule() {
  schedule = {};

  // Full-time first, then part-time
  const sortedEmployees = [...employees].sort((a, b) => {
    if (a.type !== b.type) return a.type === "full" ? -1 : 1;
    return 0;
  });

  events.forEach(event => {
    const start = new Date(event.date + "T" + event.start);
    const end = new Date(event.date + "T" + event.end);
    const hours = (end - start) / 3600000;

    const needed = recommendServers(event.guests);
    let assigned = 0;

    sortedEmployees.forEach(emp => {
      if (assigned >= needed) return;

      if (!schedule[emp.name]) schedule[emp.name] = [];

      schedule[emp.name].push({
        date: event.date,
        start: event.start,
        end: event.end,
        hours: hours
      });

      assigned++;
    });
  });

  renderSchedule();
}

function renderSchedule() {
  let html = "<table><tr><th>Employee</th><th>Assigned Shifts</th></tr>";

  employees.forEach(emp => {
    html += `<tr><td class="employee-name">${emp.name}</td><td>`;

    const shifts = schedule[emp.name] || [];
    if (shifts.length === 0) {
      html += "—";
    } else {
      shifts.forEach(s => {
        html += `${s.date} ${s.start}-${s.end} (${s.hours.toFixed(1)}h)<br>`;
      });
    }

    html += "</td></tr>";
  });

  html += "</table>";
  document.getElementById("schedule").innerHTML = html;
}

/* ================= INIT ================= */

renderEmployees();
renderEvents();
</script>

</body>
</html>
